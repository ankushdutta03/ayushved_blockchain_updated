<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>AyushVed Blockchain Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    /* 🌿 Global Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Theme Variables */
    :root {
      /* Light Theme Variables */
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #a8e6cf 75%, #4ecdc4 100%);
      --text-primary: #2d3748;
      --text-secondary: #718096;
      --card-bg: rgba(255, 255, 255, 0.95);
      --card-border: rgba(255, 255, 255, 0.3);
      --card-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 0 5px 15px rgba(0, 0, 0, 0.05);
      --card-hover-shadow: 0 20px 40px rgba(0, 0, 0, 0.15), 0 8px 20px rgba(0, 0, 0, 0.08);
      --input-bg: #f8fafc;
      --input-border: #e2e8f0;
      --input-focus-bg: #ffffff;
      --input-text: #2d3748;
      --input-placeholder: #a0aec0;
      --nav-bg: rgba(255, 255, 255, 0.15);
      --nav-border: rgba(255, 255, 255, 0.2);
      --nav-text: #fff;
      --nav-text-secondary: rgba(255, 255, 255, 0.9);
      --table-bg: #ffffff;
      --table-row-even: rgba(102, 126, 234, 0.03);
      --table-row-hover: linear-gradient(90deg, rgba(102, 126, 234, 0.05), rgba(240, 147, 251, 0.05));
      --table-border: rgba(0, 0, 0, 0.08);
      --footer-text: rgba(255, 255, 255, 0.8);
      --footer-bg: rgba(255, 255, 255, 0.1);
      --footer-border: rgba(255, 255, 255, 0.2);
      --empty-row-text: #718096;
      --h2-underline: linear-gradient(45deg, #667eea, #764ba2);
    }

    [data-theme="dark"] {
      /* Dark Theme Variables */
      --bg-gradient: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 25%, #2d2d2d 50%, #1e1e1e 75%, #0a0a0a 100%);
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --card-bg: rgba(20, 24, 32, 0.95);
      --card-border: rgba(148, 163, 184, 0.15);
      --card-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 5px 15px rgba(0, 0, 0, 0.3);
      --card-hover-shadow: 0 20px 40px rgba(0, 0, 0, 0.6), 0 8px 20px rgba(0, 0, 0, 0.4);
      --input-bg: #1e293b;
      --input-border: #475569;
      --input-focus-bg: #0f172a;
      --input-text: #f8fafc;
      --input-placeholder: #64748b;
      --nav-bg: rgba(15, 23, 42, 0.9);
      --nav-border: rgba(148, 163, 184, 0.2);
      --nav-text: #f8fafc;
      --nav-text-secondary: rgba(248, 250, 252, 0.8);
      --table-bg: #1e293b;
      --table-row-even: rgba(148, 163, 184, 0.08);
      --table-row-hover: linear-gradient(90deg, rgba(148, 163, 184, 0.12), rgba(148, 163, 184, 0.18));
      --table-border: rgba(148, 163, 184, 0.2);
      --footer-text: rgba(248, 250, 252, 0.8);
      --footer-bg: rgba(15, 23, 42, 0.8);
      --footer-border: rgba(148, 163, 184, 0.2);
      --empty-row-text: #94a3b8;
      --h2-underline: linear-gradient(45deg, #3b82f6, #8b5cf6);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
      transition: all 0.5s ease;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      transition: opacity 0.5s ease;
      opacity: 0.3;
    }

    [data-theme="light"] body::before {
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="0.5" fill="%23ffffff" opacity="0.4"/><circle cx="80" cy="80" r="0.5" fill="%23ffffff" opacity="0.3"/><circle cx="40" cy="60" r="0.5" fill="%23ffffff" opacity="0.35"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    }

    [data-theme="dark"] body::before {
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="0.5" fill="%23ffffff" opacity="0.02"/><circle cx="80" cy="80" r="0.5" fill="%23ffffff" opacity="0.015"/><circle cx="40" cy="60" r="0.5" fill="%23ffffff" opacity="0.025"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    }

    /* 🌱 Navbar */
    nav {
      background: var(--nav-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--nav-border);
      color: var(--nav-text);
      padding: 1.2rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 10;
      margin: 1rem 1rem 0 1rem;
      border-radius: 16px;
      transition: all 0.3s ease;
    }

    [data-theme="dark"] nav {
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    }

    nav .brand {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }

    [data-theme="light"] nav .brand {
      background: linear-gradient(45deg, #ffffff, #f0f0f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    [data-theme="dark"] nav .brand {
      background: linear-gradient(45deg, #f8fafc, #e2e8f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    nav .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 1rem;
      font-weight: 500;
      flex-wrap: wrap;
    }

    nav .user-info span {
      color: var(--nav-text-secondary);
      transition: color 0.3s ease;
    }

    nav a.admin {
      color: #fff;
      text-decoration: none;
      background: linear-gradient(45deg, #9333ea, #7c3aed);
      padding: 0.6rem 1.2rem;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(147, 51, 234, 0.3);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    [data-theme="dark"] nav a.admin {
      box-shadow: 0 4px 15px rgba(147, 51, 234, 0.5);
    }

    nav a.admin:hover {
      background: linear-gradient(45deg, #7c3aed, #6b21a8);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(147, 51, 234, 0.4);
    }

    [data-theme="dark"] nav a.admin:hover {
      box-shadow: 0 6px 20px rgba(147, 51, 234, 0.6);
    }

    nav a.profile {
      color: #fff;
      text-decoration: none;
      background: linear-gradient(45deg, #4ecdc4, #44a08d);
      padding: 0.6rem 1.2rem;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    [data-theme="dark"] nav a.profile {
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
    }

    nav a.profile:hover {
      background: linear-gradient(45deg, #44a08d, #2a9d8f);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
    }

    [data-theme="dark"] nav a.profile:hover {
      box-shadow: 0 6px 20px rgba(78, 205, 196, 0.6);
    }

    nav a.logout {
      color: #fff;
      text-decoration: none;
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      padding: 0.6rem 1.2rem;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(238, 90, 36, 0.3);
    }

    [data-theme="dark"] nav a.logout {
      box-shadow: 0 4px 15px rgba(238, 90, 36, 0.5);
    }

    nav a.logout:hover {
      background: linear-gradient(45deg, #ee5a24, #c0392b);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(238, 90, 36, 0.4);
    }

    [data-theme="dark"] nav a.logout:hover {
      box-shadow: 0 6px 20px rgba(238, 90, 36, 0.6);
    }

    /* Theme Toggle Button */
    .theme-toggle {
      background: linear-gradient(45deg, #6366f1, #8b5cf6);
      color: #fff;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-family: 'Poppins', sans-serif;
      position: relative;
      overflow: hidden;
    }

    [data-theme="dark"] .theme-toggle {
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.5);
    }

    .theme-toggle::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .theme-toggle:hover::before {
      left: 100%;
    }

    .theme-toggle:hover {
      background: linear-gradient(45deg, #8b5cf6, #a855f7);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }

    [data-theme="dark"] .theme-toggle:hover {
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6);
    }

    /* 🌾 Container */
    .container {
      flex: 1;
      width: 95%;
      max-width: 1200px;
      margin: 2rem auto;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      position: relative;
      z-index: 1;
    }

    h2 {
      color: var(--text-primary);
      margin-bottom: 1.5rem;
      font-weight: 600;
      font-size: 1.5rem;
      position: relative;
      transition: color 0.3s ease;
    }

    h2::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 60px;
      height: 3px;
      background: var(--h2-underline);
      border-radius: 2px;
    }
/* NEW: Farmer Tools Navigation - Dark Mode Support */
.farmer-tools-card {
  background: var(--card-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--card-border);
  border-radius: 20px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--card-shadow);
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

/* EXPLICIT Dark Mode Override */
[data-theme="dark"] .farmer-tools-card {
  background: rgba(30, 41, 59, 0.8) !important;
  border: 1px solid rgba(148, 163, 184, 0.2) !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
}

.farmer-tools-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #28a745, #20c997, #17a2b8);
  border-radius: 20px 20px 0 0;
}

.farmer-tools-title {
  color: var(--text-primary);
  margin-bottom: 15px;
  font-size: 1.2rem;
  font-weight: 600;
  background: linear-gradient(45deg, #28a745, #20c997);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  transition: all 0.3s ease;
}

/* EXPLICIT Dark Mode Title Fix */
[data-theme="dark"] .farmer-tools-title {
  color: #f8fafc !important;
  background: linear-gradient(45deg, #10b981, #14b8a6) !important;
  -webkit-background-clip: text !important;
  -webkit-text-fill-color: transparent !important;
}

.farmer-tools-buttons {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  align-items: center;
}

.farmer-btn {
  display: inline-flex;
  align-items: center;
  width: auto;
  margin: 0;
  padding: 0.8rem 1.5rem;
  text-decoration: none;
  color: white;
  font-size: 0.95rem;
  font-weight: 600;
  gap: 0.5rem;
  border-radius: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  border: none;
  cursor: pointer;
  font-family: inherit;
}

.farmer-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.farmer-btn-primary {
  background: linear-gradient(45deg, #28a745, #20c997);
}

.farmer-btn-primary:hover {
  background: linear-gradient(45deg, #20c997, #17a2b8);
}

.farmer-btn-secondary {
  background: linear-gradient(45deg, #17a2b8, #138496);
}

.farmer-btn-secondary:hover {
  background: linear-gradient(45deg, #138496, #0f6674);
}

.farmer-btn-accent {
  background: linear-gradient(45deg, #ffc107, #e0a800);
  color: #212529;
}

.farmer-btn-accent:hover {
  background: linear-gradient(45deg, #e0a800, #d39e00);
  color: #000;
}

  /* Dark Mode Adjustments for Farmer Tools */
[data-theme="dark"] .farmer-btn {
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
}

[data-theme="dark"] .farmer-btn:hover {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5) !important;
}

[data-theme="dark"] .farmer-btn-accent {
  color: #212529;
}

[data-theme="dark"] .farmer-btn-accent:hover {
  color: #000;
}
   /* UPDATED: Blockchain Statistics Grid - All Cards Match */
.blockchain-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-radius: 16px;
  padding: 1.5rem;
  text-align: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

/* Light Theme Stats */
[data-theme="light"] .stat-card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  box-shadow: var(--card-shadow);
}

/* Dark Theme Stats - ALL CARDS SAME BACKGROUND */
[data-theme="dark"] .stat-card {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  border: 1px solid rgba(148, 163, 184, 0.2);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
  color: white;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  border-radius: 16px 16px 0 0;
}

/* Top Border Colors */
.stat-card:nth-child(1)::before { 
  background: linear-gradient(90deg, #10b981, #059669); /* Green for Herb Batches */
}
.stat-card:nth-child(2)::before { 
  background: linear-gradient(90deg, #8b5cf6, #7c3aed); /* Purple for Blocks */
}
.stat-card:nth-child(3)::before { 
  background: linear-gradient(90deg, #3b82f6, #2563eb); /* Blue for Transactions */
}
.stat-card:nth-child(4)::before { 
  background: linear-gradient(90deg, #10b981, #059669); /* Green for Chain Status */
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--card-hover-shadow);
}

[data-theme="dark"] .stat-card:hover {
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.stat-number {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

/* ALL Dark Theme Numbers - White */
[data-theme="dark"] .stat-number {
  color: #ffffff;
}

/* Light Theme Numbers */
[data-theme="light"] .stat-number {
  color: var(--text-primary);
  background: linear-gradient(45deg, #667eea, #764ba2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Chain Status Checkmark Visibility Fix */
.stat-card:nth-child(4) .stat-number {
  font-size: 2.5rem !important;
}

[data-theme="light"] .stat-card:nth-child(4) .stat-number {
  color: #28a745 !important;
  background: none !important;
  -webkit-background-clip: initial !important;
  -webkit-text-fill-color: #28a745 !important;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
}

[data-theme="dark"] .stat-card:nth-child(4) .stat-number {
  color: #10b981 !important;
  text-shadow: 0 1px 3px rgba(0,0,0,0.7);
}

.stat-label {
  font-weight: 500;
  text-transform: uppercase;
  font-size: 0.85rem;
  letter-spacing: 0.5px;
  opacity: 0.8;
}

/* ALL Dark Theme Labels - White */
[data-theme="dark"] .stat-label {
  color: rgba(255, 255, 255, 0.9);
}

/* Light Theme Labels */
[data-theme="light"] .stat-label {
  color: var(--text-secondary);
}

/* Remove any blockchain-stat specific styling */
.stat-card.blockchain-stat {
  /* Override removed - all cards use same styling now */
}

    /* 🌿 Card */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: var(--card-shadow);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      border-radius: 20px 20px 0 0;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .card::before {
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #4ecdc4);
    }

    [data-theme="dark"] .card::before {
      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899, #10b981);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--card-hover-shadow);
    }

    /* 🌱 Form Styling */
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    input, textarea, button[type="button"], select {
      width: 100%;
      padding: 1rem 1.2rem;
      border: 2px solid var(--input-border);
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 400;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: var(--input-bg);
      color: var(--input-text);
      font-family: 'Poppins', sans-serif;
    }

    input::placeholder, textarea::placeholder {
      color: var(--input-placeholder);
      font-weight: 300;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      background: var(--input-focus-bg);
      transform: translateY(-2px);
    }

    [data-theme="light"] input:focus,
    [data-theme="light"] textarea:focus,
    [data-theme="light"] select:focus {
      border-color: #667eea;
      box-shadow: 
        0 0 0 3px rgba(102, 126, 234, 0.1),
        0 4px 20px rgba(102, 126, 234, 0.15);
    }

    [data-theme="dark"] input:focus,
    [data-theme="dark"] textarea:focus,
    [data-theme="dark"] select:focus {
      border-color: #3b82f6;
      box-shadow: 
        0 0 0 3px rgba(59, 130, 246, 0.2),
        0 4px 20px rgba(59, 130, 246, 0.25);
    }

    textarea {
      grid-column: 1 / -1;
      resize: vertical;
      min-height: 80px;
    }

    button[type="button"] {
      background: linear-gradient(45deg, #4ecdc4, #44a08d);
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    button[type="button"]:hover {
      background: linear-gradient(45deg, #44a08d, #2a9d8f);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(68, 160, 141, 0.4);
    }

    [data-theme="dark"] button[type="button"]:hover {
      box-shadow: 0 8px 25px rgba(68, 160, 141, 0.6);
    }

    .btn-submit {
      grid-column: 1 / -1;
      justify-self: end;
      color: #fff;
      padding: 1rem 2rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    [data-theme="light"] .btn-submit {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    }

    [data-theme="dark"] .btn-submit {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
    }

    .btn-submit::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .btn-submit:hover::before {
      left: 100%;
    }

    .btn-submit:hover {
      transform: translateY(-3px);
    }

    [data-theme="light"] .btn-submit:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 50%, #ec4899 100%);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    [data-theme="dark"] .btn-submit:hover {
      background: linear-gradient(135deg, #2563eb 0%, #7c3aed 50%, #db2777 100%);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
    }

    /* 🌾 Table */
    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 16px;
      overflow: hidden;
      margin-top: 1rem;
      font-size: 0.95rem;
      box-shadow: 0 8px 25px var(--table-border);
      background: var(--table-bg);
      transition: all 0.3s ease;
    }

    th, td {
      padding: 1rem 1.2rem;
      text-align: left;
      color: var(--text-primary);
      transition: color 0.3s ease;
    }

    th {
      color: #fff !important;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 0.5px;
    }

    [data-theme="light"] th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    [data-theme="dark"] th {
      background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);
    }

    tr:nth-child(even) {
      background: var(--table-row-even);
    }

    tr:hover {
      background: var(--table-row-hover);
      transform: scale(1.01);
      transition: all 0.2s ease;
    }

    .empty-row-text {
      color: var(--empty-row-text) !important;
      transition: color 0.3s ease;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      color: #fff;
      margin-right: 0.5rem;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-block;
      text-decoration: none;
    }

    .action-btn:hover {
      transform: translateY(-2px);
    }

    .edit {
      background: linear-gradient(45deg, #f4a261, #e76f51);
    }

    .edit:hover {
      background: linear-gradient(45deg, #e76f51, #d62828);
      box-shadow: 0 6px 20px rgba(231, 111, 81, 0.4);
    }

    [data-theme="dark"] .edit:hover {
      box-shadow: 0 6px 20px rgba(231, 111, 81, 0.6);
    }

    .delete {
      background: linear-gradient(45deg, #e63946, #d62828);
    }

    .delete:hover {
      background: linear-gradient(45deg, #d62828, #ba181b);
      box-shadow: 0 6px 20px rgba(214, 40, 40, 0.4);
    }

    [data-theme="dark"] .delete:hover {
      box-shadow: 0 6px 20px rgba(214, 40, 40, 0.6);
    }

    .qr-btn {
      background: linear-gradient(45deg, #2a9d8f, #264653);
    }

    .qr-btn:hover {
      background: linear-gradient(45deg, #264653, #1d3557);
      box-shadow: 0 6px 20px rgba(42, 157, 143, 0.4);
    }

    [data-theme="dark"] .qr-btn:hover {
      box-shadow: 0 6px 20px rgba(42, 157, 143, 0.6);
    }

    .trace-btn {
      background: linear-gradient(45deg, #f4d35e, #faa307);
      color: #333;
    }

    .trace-btn:hover {
      background: linear-gradient(45deg, #faa307, #f48c06);
      box-shadow: 0 6px 20px rgba(244, 211, 94, 0.4);
    }

    [data-theme="dark"] .trace-btn:hover {
      box-shadow: 0 6px 20px rgba(244, 211, 94, 0.6);
    }

    /* Blockchain-specific styling */
    .hash-badge {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.75rem;
      font-family: 'Courier New', monospace;
      display: inline-block;
      max-width: 150px;
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .verification-badge {
      background: linear-gradient(45deg, #38a169, #2f855a);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.75rem;
      display: inline-block;
    }

    .verification-badge.corrected {
      background: linear-gradient(45deg, #f59e0b, #d97706);
    }

    /* Scanner Section */
    .scanner-section {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
      text-align: center;
      transition: all 0.3s ease;
    }

    .scanner-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      border-radius: 20px 20px 0 0;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .scanner-section::before {
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #4ecdc4);
    }

    [data-theme="dark"] .scanner-section::before {
      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899, #10b981);
    }

    .scanner-section h3 {
      color: var(--text-primary);
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1rem;
      transition: color 0.3s ease;
    }

    [data-theme="light"] .scanner-section h3 {
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    [data-theme="dark"] .scanner-section h3 {
      background: linear-gradient(45deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .scanner-section p {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.5;
      transition: color 0.3s ease;
    }

    .scanner-btn-large {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #ffffff;
      text-decoration: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    [data-theme="light"] .scanner-btn-large {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    [data-theme="dark"] .scanner-btn-large {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }

    .scanner-btn-large::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .scanner-btn-large:hover::before {
      left: 100%;
    }

    .scanner-btn-large:hover {
      transform: translateY(-3px);
    }

    [data-theme="light"] .scanner-btn-large:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 50%, #ec4899 100%);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    }

    [data-theme="dark"] .scanner-btn-large:hover {
      background: linear-gradient(135deg, #2563eb 0%, #7c3aed 50%, #db2777 100%);
      box-shadow: 0 12px 35px rgba(59, 130, 246, 0.5);
    }

    /* 🌿 Footer */
    footer {
      text-align: center;
      color: var(--footer-text);
      padding: 1.5rem 0;
      margin: 2rem 1rem 1rem 1rem;
      font-size: 0.9rem;
      background: var(--footer-bg);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid var(--footer-border);
      transition: all 0.3s ease;
    }

    /* MongoDB ObjectId Badge */
    .id-badge {
      background: linear-gradient(45deg, #4ecdc4, #44a08d);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.75rem;
      display: inline-block;
      max-width: 120px;
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* NEW: Pricing Section Styling */
    .pricing-section {
      background: rgba(240, 248, 255, 0.7);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem 0;
      grid-column: 1 / -1;
    }

    [data-theme="dark"] .pricing-section {
      background: rgba(30, 41, 59, 0.7);
      border-color: rgba(59, 130, 246, 0.3);
    }

    .pricing-section h4 {
      color: var(--text-primary);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .calc-display {
      background: rgba(248, 250, 252, 0.8);
      border: 1px solid rgba(226, 232, 240, 0.5);
      border-radius: 8px;
      padding: 0.8rem;
      margin-top: 1rem;
      font-weight: 600;
      color: #059669;
      text-align: center;
      transition: all 0.3s ease;
    }

    [data-theme="dark"] .calc-display {
      background: rgba(15, 23, 42, 0.8);
      border-color: rgba(71, 85, 105, 0.5);
      color: #10b981;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      nav {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
        margin: 0.5rem;
        padding: 1rem;
      }

      nav .brand {
        font-size: 1.5rem;
      }

      nav .user-info {
        flex-direction: column;
        gap: 0.8rem;
      }

      .container {
        width: 95%;
        margin: 1rem auto;
        gap: 1.5rem;
      }

      .card, .scanner-section {
        padding: 1.5rem;
      }

      form {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .btn-submit {
        width: 100%;
        justify-self: stretch;
      }

      table {
        font-size: 0.8rem;
      }

      th, td {
        padding: 0.7rem 0.5rem;
      }

      .action-btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.75rem;
        margin: 0.2rem;
        display: block;
        margin-bottom: 0.3rem;
      }

      .blockchain-stats {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .farmer-tools-buttons {
        flex-direction: column;
        width: 100%;
      }
      
      .farmer-btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      nav {
        margin: 0;
        border-radius: 0;
      }

      .container {
        width: 100%;
        margin: 1rem 0;
        padding: 0 0.5rem;
      }

      .card, .scanner-section {
        margin: 0 0.5rem;
        border-radius: 16px;
      }

      nav .user-info {
        gap: 0.5rem;
      }

      nav a.admin,
      nav a.profile,
      nav a.logout,
      .theme-toggle {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }

      .blockchain-stats {
        grid-template-columns: 1fr;
      }
    }

    /* Loading Animation */
    .loading {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 1s ease-in-out infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>


 <!-- 🌿 Navbar -->
  <nav>
    <div class="brand">🌿⛓️ AyushVed</div>
    <div class="user-info">
      {% if current_user %}
        <span>Welcome, {{ current_user.username }}</span>
      {% elif user %}
        <span>Welcome, {{ user.username }}</span>
      {% else %}
        <span>Welcome, User</span>
      {% endif %}
      
      {% if current_user and current_user.is_admin %}
        <a href="{{ url_for('admin_panel') }}" class="admin">
          🔧⛓️ Blockchain Admin
        </a>
      {% elif user and user.is_admin %}
        <a href="{{ url_for('admin_panel') }}" class="admin">
          🔧⛓️ Blockchain Admin
        </a>
      {% endif %}
      
      <a href="{{ url_for('profile') }}" class="profile">
        👤 View Profile
      </a>
      <a href="{{ url_for('logout') }}" class="logout">Logout</a>
      <button class="theme-toggle" onclick="toggleTheme()">
        <span id="themeIcon">🌙</span>
        <span id="themeText">Dark Mode</span>
      </button>
    </div>
  </nav>

  <div class="container">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }}" style="
              padding: 1rem 1.5rem; 
              border-radius: 12px; 
              margin-bottom: 1.5rem; 
              font-weight: 500;
              background: {% if category == 'success' %}linear-gradient(45deg, rgba(56, 161, 105, 0.15), rgba(152, 230, 180, 0.15)){% else %}linear-gradient(45deg, rgba(229, 62, 62, 0.15), rgba(252, 129, 129, 0.15)){% endif %};
              border: 1px solid {% if category == 'success' %}rgba(56, 161, 105, 0.3){% else %}rgba(229, 62, 62, 0.3){% endif %};
              color: {% if category == 'success' %}var(--text-primary){% else %}var(--text-primary){% endif %};
              backdrop-filter: blur(10px);
              transition: all 0.3s ease;">
              {% if category == 'success' %}✅{% else %}⚠️{% endif %} {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

<!-- NEW: Farmer Tools Navigation -->
<div class="card farmer-tools-card">
  <h4 class="farmer-tools-title">👨‍🌾 Farmer Tools</h4>
  <div class="farmer-tools-buttons">
    <a href="{{ url_for('farmer_inventory') }}" class="btn-submit farmer-btn farmer-btn-primary">
      📦 View Inventory
    </a>
    
    <!-- FIXED: Points to add batch form, not scanner -->
    <a href="#add-batch" class="btn-submit farmer-btn farmer-btn-secondary" onclick="document.getElementById('add-batch').scrollIntoView({behavior: 'smooth'});">
      ➕ Add New Batch
    </a>
  </div>
</div>


    <!-- CORRECTED: Blockchain Statistics -->
    <div class="blockchain-stats">
      <div class="stat-card">
        <div class="stat-number">{{ total_batches or 0 }}</div>
        <div class="stat-label">🌿 Herb Batches</div>
      </div>
      <div class="stat-card blockchain-stat">
        <div class="stat-number">{{ blockchain_blocks or 0 }}</div>
        <div class="stat-label">⛓️ Total Blocks</div>
      </div>
      <div class="stat-card blockchain-stat">
        <div class="stat-number">{{ blockchain_transactions or 0 }}</div>
        <div class="stat-label">📝 Transactions</div>
      </div>
      <div class="stat-card blockchain-stat">
        <div class="stat-number">{% if blockchain_valid %}✅{% else %}❌{% endif %}</div>
        <div class="stat-label">🔐 Chain Status</div>
      </div>
    </div>

    <!-- 🌱 ENHANCED Add Herb Batch with Weight & Pricing -->
    <div class="card" id="add-batch">
      <h2>⛓️ Add New Herb Batch to Immutable Blockchain</h2>
      <form method="POST" action="{{ url_for('add_batch') }}">
        <input type="text" name="herb_name" placeholder="Herb Name" required>
        <input type="text" name="collector_name" placeholder="Collector Name" required>
        <input type="text" name="farm_location" placeholder="Farm Location" required>
        <input type="text" name="latitude" id="latitude" placeholder="Latitude">
        <input type="text" name="longitude" id="longitude" placeholder="Longitude">

        <!-- NEW: Enhanced Weight and Pricing Section -->
        <div class="pricing-section">
          <h4>💰 Weight & Pricing Information</h4>
          
          <!-- Weight -->
          <input type="number" name="total_weight" step="0.001" min="0.001" 
                 placeholder="Enter weight amount" required onchange="calculateTotalValue()">
          
          <select name="weight_unit" onchange="calculateTotalValue()">
            <optgroup label="📊 Metric System">
              <option value="kg" selected>Kilogram (kg)</option>
              <option value="g">Gram (g)</option>
              <option value="ton">Metric Ton</option>
              <option value="quintal">Quintal (100kg)</option>
            </optgroup>
            <optgroup label="🇮🇳 Indian Traditional">
              <option value="maund">Maund (40kg)</option>
              <option value="seer">Seer (0.933kg)</option>
            </optgroup>
            <optgroup label="🇺🇸 Imperial">
              <option value="lb">Pound (lb)</option>
              <option value="oz">Ounce (oz)</option>
            </optgroup>
            <optgroup label="📦 Commercial">
              <option value="bag">Bag (50kg)</option>
              <option value="sack">Sack (25kg)</option>
            </optgroup>
          </select>
          
          <!-- Currency -->
          <select name="currency" onchange="calculateTotalValue()">
            <optgroup label="🌍 Major Currencies">
              <option value="INR" selected>🇮🇳 Indian Rupee (₹)</option>
              <option value="USD">🇺🇸 US Dollar ($)</option>
              <option value="EUR">🇪🇺 Euro (€)</option>
              <option value="GBP">🇬🇧 British Pound (£)</option>
            </optgroup>
            <optgroup label="🏛️ Asian Markets">
              <option value="CNY">🇨🇳 Chinese Yuan (¥)</option>
              <option value="JPY">🇯🇵 Japanese Yen (¥)</option>
              <option value="BDT">🇧🇩 Bangladeshi Taka</option>
              <option value="LKR">🇱🇰 Sri Lankan Rupee</option>
            </optgroup>
            <optgroup label="₿ Crypto">
              <option value="BTC">₿ Bitcoin</option>
              <option value="ETH">Ξ Ethereum</option>
              <option value="USDT">₮ Tether</option>
            </optgroup>
          </select>
          
          <!-- Price -->
          <input type="number" name="price_per_unit" step="0.01" min="0.01" 
                 placeholder="Enter price amount" required onchange="calculateTotalValue()">
          
          <select name="price_unit" onchange="calculateTotalValue()">
            <option value="per_kg" selected>per Kg</option>
            <option value="per_g">per Gram</option>
            <option value="per_lb">per Pound</option>
            <option value="per_quintal">per Quintal</option>
            <option value="per_bag">per Bag</option>
            <option value="total_batch">Total Batch Price</option>
          </select>
          
          <!-- Quality and Packaging -->
          <input type="date" name="harvest_date" placeholder="Harvest Date">
          
          <select name="quality_grade">
            <option value="Premium">🥇 Premium (A+)</option>
            <option value="Standard" selected>⭐ Standard (A)</option>
            <option value="Commercial">📦 Commercial (B)</option>
            <option value="Organic">🌱 Organic Certified</option>
          </select>
          
          <select name="packaging">
            <option value="bulk" selected>📦 Bulk</option>
            <option value="jute_bags">🛍️ Jute Bags</option>
            <option value="vacuum_sealed">🔒 Vacuum Sealed</option>
            <option value="dried_leaves">🍃 Dried Leaves</option>
          </select>
          
          <!-- Calculated Values Display -->
          <div class="calc-display" id="weight_in_kg" style="display: none;"></div>
          <div class="calc-display" id="price_in_inr_kg" style="display: none;"></div>
          <div class="calc-display" id="total_value" style="display: none;"></div>
        </div>

        <button type="button" onclick="getLocation()">📍 Get My Location</button>
        <textarea name="notes" rows="3" placeholder="Additional notes about this herb batch (storage conditions, processing method, certifications, etc.)..."></textarea>
        <button type="submit" class="btn-submit">
          <span>⛓️ Add to Immutable Blockchain</span>
          <div class="loading"></div>
        </button>
      </form>
    </div>

    <!-- 🌿 ENHANCED Display Table with Weight & Pricing -->
    <div class="card">
      <h2>🌿⛓️ Your Immutable Blockchain Herb Batches</h2>
      <table>
        <thead>
          <tr>
            <th>Batch ID</th>
            <th>Herb Name</th>
            <th>Weight</th>
            <th>Price/kg</th>
            <th>Total Value</th>
            <th>Quality</th>
            <th>✅ Status</th>
            <th>⛓️ Blockchain Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for batch in herb_batches %}
          <tr>
            <td>
              <span class="id-badge" title="{{ batch.batch_number or batch._id }}">
                {{ batch.batch_number[:12] if batch.batch_number else batch._id|string|truncate(12, True, '...') }}
              </span>
            </td>
            <td><strong>{{ batch.herb_name }}</strong></td>
            <td>
              {% if batch.weight_kg %}
                <span style="color: #28a745; font-weight: bold;">{{ "%.2f"|format(batch.weight_kg) }}kg</span>
                {% if batch.original_weight and batch.original_weight_unit %}
                  <br><small style="color: #6c757d;">({{ batch.original_weight }}{{ batch.original_weight_unit }})</small>
                {% endif %}
              {% else %}
                <span style="color: #6c757d;">N/A</span>
              {% endif %}
            </td>
            <td>
              {% if batch.price_per_kg_inr %}
                <span style="color: #17a2b8; font-weight: bold;">₹{{ "%.2f"|format(batch.price_per_kg_inr) }}</span>
                {% if batch.original_currency != 'INR' %}
                  <br><small style="color: #6c757d;">({{ batch.original_currency }})</small>
                {% endif %}
              {% else %}
                <span style="color: #6c757d;">N/A</span>
              {% endif %}
            </td>
            <td>
              {% if batch.total_value_inr %}
                <span style="color: #28a745; font-weight: bold; font-size: 16px;">₹{{ "%.2f"|format(batch.total_value_inr) }}</span>
              {% else %}
                <span style="color: #6c757d;">N/A</span>
              {% endif %}
            </td>
            <td>
              {% if batch.quality_grade %}
                <span style="background: #e8f5e8; color: #28a745; padding: 2px 6px; border-radius: 3px; font-size: 11px;">
                  {{ batch.quality_grade }}
                </span>
              {% else %}
                <span style="color: #6c757d;">N/A</span>
              {% endif %}
            </td>
            <td>
              <span class="verification-badge">✅ Immutable</span>
            </td>
            <td>
              <a href="{{ url_for('correct_batch', batch_id=batch._id|string) }}" class="action-btn edit" title="Verify batch on blockchain">🔧Correction</a>
              <a href="{{ url_for('immutable_proven', batch_id=batch._id|string) }}" class="action-btn trace-btn" title="View blockchain proof">🔗Proof</a>
              <a href="{{ url_for('generate_qr', batch_id=batch._id|string) }}" target="_blank" class="action-btn qr-btn" title="Generate QR code">📱QR Code</a>
              <a href="{{ url_for('provenance', batch_id=batch._id|string) }}" class="action-btn trace-btn" title="View complete blockchain history">🔍Full History</a>
              <!-- NEW: Batch Details Button -->
              <a href="{{ url_for('batch_details', batch_id=batch._id|string) }}" class="action-btn" style="background: linear-gradient(45deg, #28a745, #20c997);" title="View detailed batch information">👁️Details</a>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="8" style="text-align:center; font-style: italic; padding: 2rem;" class="empty-row-text">
              No herb batches added to immutable blockchain yet. Start by adding your first batch above! 🌱⛓️💰
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- 📱 QR Scanner Section -->
    <div class="scanner-section">
      <h3>📱⛓️ Immutable Blockchain QR Scanner</h3>
      <p>Scan QR codes from herb batches to view their complete immutable blockchain history including all corrections and cryptographic proof of authenticity.</p>
      <a href="{{ url_for('scan') }}" class="scanner-btn-large">
        📷 Open Immutable Scanner
      </a>
    </div>

  </div>

  <footer>
    © 2025 AyushVed Immutable Blockchain | Botanical Traceability System 🌿⛓️
  </footer>

  <script>
    // Weight and Currency Conversion Constants
    const WEIGHT_CONVERSIONS = {
      'kg': 1, 'g': 0.001, 'ton': 1000, 'quintal': 100,
      'lb': 0.453592, 'oz': 0.0283495, 'maund': 40, 'seer': 0.933,
      'bag': 50, 'sack': 25
    };

    const CURRENCY_CONVERSIONS = {
      'INR': 1, 'USD': 83.25, 'EUR': 90.15, 'GBP': 104.50,
      'CNY': 11.45, 'JPY': 0.56, 'BDT': 0.76, 'LKR': 0.27,
      'BTC': 2750000, 'ETH': 200000, 'USDT': 83.25
    };

    function calculateTotalValue() {
      const weight = parseFloat(document.querySelector('input[name="total_weight"]').value) || 0;
      const weightUnit = document.querySelector('select[name="weight_unit"]').value;
      const price = parseFloat(document.querySelector('input[name="price_per_unit"]').value) || 0;
      const currency = document.querySelector('select[name="currency"]').value;
      const priceUnit = document.querySelector('select[name="price_unit"]').value;
      
      const weightDisplay = document.getElementById('weight_in_kg');
      const priceDisplay = document.getElementById('price_in_inr_kg');
      const totalDisplay = document.getElementById('total_value');
      
      if (weight <= 0 || price <= 0) {
        weightDisplay.style.display = 'none';
        priceDisplay.style.display = 'none';
        totalDisplay.style.display = 'none';
        return;
      }
      
      // Convert weight to kg
      const weightInKg = weight * (WEIGHT_CONVERSIONS[weightUnit] || 1);
      
      // Convert price to INR
      let priceInINR = price * (CURRENCY_CONVERSIONS[currency] || 1);
      
      // Adjust price based on price unit
      if (priceUnit === 'total_batch') {
        priceInINR = priceInINR / weightInKg;
      } else if (priceUnit !== 'per_kg') {
        const priceUnitWeight = priceUnit.replace('per_', '');
        const priceUnitConversion = WEIGHT_CONVERSIONS[priceUnitWeight] || 1;
        priceInINR = priceInINR / priceUnitConversion;
      }
      
      const totalValue = weightInKg * priceInINR;
      
      // Update display
      weightDisplay.textContent = `⚖️ Weight: ${weightInKg.toFixed(3)} kg`;
      weightDisplay.style.display = 'block';
      
      priceDisplay.textContent = `💰 Price: ₹${priceInINR.toFixed(2)}/kg`;
      priceDisplay.style.display = 'block';
      
      totalDisplay.textContent = `💵 Total Value: ₹${totalValue.toFixed(2)}`;
      totalDisplay.style.display = 'block';
    }

    // Theme Toggle Functionality
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      console.log('Toggling theme from', currentTheme, 'to', newTheme);
      
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      
      // Update button text and icon
      const themeIcon = document.getElementById('themeIcon');
      const themeText = document.getElementById('themeText');
      
      if (newTheme === 'dark') {
        themeIcon.textContent = '☀️';
        themeText.textContent = 'Light Mode';
        console.log('Switched to dark mode');
      } else {
        themeIcon.textContent = '🌙';
        themeText.textContent = 'Dark Mode';
        console.log('Switched to light mode');
      }
      
      // Broadcast theme change to other pages
      window.dispatchEvent(new CustomEvent('themeChanged', { detail: { theme: newTheme } }));
    }

    // Load saved theme on page load
    document.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      const html = document.documentElement;
      const themeIcon = document.getElementById('themeIcon');
      const themeText = document.getElementById('themeText');
      
      console.log('Loading saved theme:', savedTheme);
      
      html.setAttribute('data-theme', savedTheme);
      
      if (savedTheme === 'dark') {
        themeIcon.textContent = '☀️';
        themeText.textContent = 'Light Mode';
        console.log('Loaded dark mode');
      } else {
        themeIcon.textContent = '🌙';
        themeText.textContent = 'Dark Mode';
        console.log('Loaded light mode');
      }

      // Add event listeners for calculation
      const inputs = ['total_weight', 'price_per_unit'];
      const selects = ['weight_unit', 'currency', 'price_unit'];
      
      inputs.forEach(name => {
        const element = document.querySelector(`input[name="${name}"]`);
        if (element) element.addEventListener('input', calculateTotalValue);
      });
      
      selects.forEach(name => {
        const element = document.querySelector(`select[name="${name}"]`);
        if (element) element.addEventListener('change', calculateTotalValue);
      });
    });

    function getLocation() {
      const button = event.target;
      const originalText = button.textContent;
      
      if (navigator.geolocation) {
        button.textContent = '📍 Getting location...';
        button.disabled = true;
        
        navigator.geolocation.getCurrentPosition(
          function(position) {
            document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
            document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
            button.textContent = '✅ Location captured!';
            setTimeout(() => {
              button.textContent = originalText;
              button.disabled = false;
            }, 2000);
          },
          function(error) {
            alert("Error getting location: " + error.message);
            button.textContent = originalText;
            button.disabled = false;
          }
        );
      } else {
        alert("Geolocation is not supported by your browser.");
      }
    }

    // Add form submission animation
    document.querySelector('form').addEventListener('submit', function(e) {
      const button = document.querySelector('.btn-submit');
      const span = button.querySelector('span');
      const loading = button.querySelector('.loading');
      
      span.style.display = 'none';
      loading.style.display = 'block';
      button.disabled = true;
    });

    // Add smooth hover effects to cards
    document.querySelectorAll('.card, .scanner-section').forEach(card => {
      card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px) scale(1.02)';
      });
      
      card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0) scale(1)';
      });
    });

    // Blockchain stats auto-refresh every 30 seconds
    setInterval(() => {
      fetch('{{ url_for("api_validate_chain") }}')
        .then(response => response.json())
        .then(data => {
          console.log('Blockchain stats updated:', data);
          // Update stats display if needed
        })
        .catch(error => console.log('Stats update failed:', error));
    }, 30000);

  </script>

</body>
</html>
